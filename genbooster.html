<!DOCTYPE html>
<html>
<head>
<title>dierk/genbooster - generate MTG boosters from a seed</title>
<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/christianbach/tablesorter/master/themes/blue/style.css">
</head>
<body onload="start();">

<script src="./genbooster_bundle.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdn.rawgit.com/christianbach/tablesorter/master/jquery.tablesorter.min.js"></script>

<script>
function get_args() {
	var rv = {};

	var args = window.location.href.replace(/^.*#/, '');
	args.split(/;/).forEach(function(arg) {
		var kv = arg.split(/=/, 2);
		rv[kv[0]] = kv[1];
	});

	return rv;
}

function card2row(c) {
	return '<tr><td>' + c.title + '</td>' +
		'<td>' + c.set + '</td>' +
		'<td>' + c.cost + '</td>' +
		'<td>' + c.cmc + '</td>' +
		'<td>' + c.colour + '</td>' +
		'<td>' + c.type + '</td>' +
		'<td>' + c.subtype + '</td>' +
		'<td>' + c.rarity + '</td>' +
		'<td>' + c.power + '</td>' +
		'<td>' + c.toughness + '</td>' +
		'</tr>';
}

function append_cards(cards) {
	var pre_el = document.getElementById('cards_pre');
	var table_el = document.getElementById('cards_table_body');

	for(var i in cards) {
		var c = cards[i];
		var usable = true;

		if('usableForDeckBuilding' in c) {
			usable = c.usableForDeckBuilding;
		}

		if(('token' in c) && (c.token == true || c.token == 'true')) {
			usable = false;
		}

		if(usable) {
			pre_el.insertAdjacentHTML('beforeend', c.title + "\n");
			table_el.insertAdjacentHTML('beforeend', card2row(c));
		}
	}

	pre_el.insertAdjacentHTML('beforeend', "\n");
}

function generate_some(gb, num, set, product) {
	for(var i = 0; i < num; i++) {
		var res = gb.run(set, product);
		append_cards(res);
	}
}

function start() {
	var args = get_args();
	var seed = args.seed;
	var setstr = args.sets;

	var rng = new window.prng_aes(seed);
	var gb = new window.genbooster(rng);

	var setlist = setstr.split(',');
	for(var i in setlist) {
		var match = setlist[i].match(/^(\d+)(...)\.(.*)$/);
		if(!match) {
			throw "error";
		}

		var num = match[1];
		var set = match[2];
		var product = match[3];

		generate_some(gb, num, set, product);
	}
}

$(document).ready(function() {
	$('#cards_table').tablesorter();
});

</script>

<p>Scroll down for a copy&amp;pasteable list of names only</p>
<p>Hold SHIFT to sort on multiple columns</p>
<table id="cards_table" class="tablesorter">
<thead>
<tr>
	<th>Name</th>
	<th>Set</th>
	<th>Cost</th>
	<th>CMC</th>
	<th>Colour</th>
	<th>Type</th>
	<th>Subtype</th>
	<th>Rarity</th>
	<th>Power</th>
	<th>Toughness</th>
</tr>
</thead>
<tbody id="cards_table_body">
</tbody>
</table>

<pre id="cards_pre"></pre>

</body>
</html>
